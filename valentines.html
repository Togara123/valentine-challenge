<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #ff4d6d;
            --secondary: #ffb3c1;
            --glass: rgba(255, 255, 255, 0.25);
        }
        
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #fff0f3, #ffb3c1);
            cursor: crosshair;
        }

        /* Start Screen */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--glass); backdrop-filter: blur(15px);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; z-index: 1000;
            transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1);
        }
        
        .game-title {
            font-family: 'Arial';
            font-size: 4.5rem;
            color: var(--primary);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin: 0 0 30px 0;
            text-align: center;
        }
        
        .start-btn {
            padding: 15px 40px; 
            font-size: 1.5rem; 
            border-radius: 50px;
            border: none; 
            background: white; 
            color: var(--primary);
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-weight: bold; 
            transition: all 0.3s ease;
        }
        
        .start-btn:hover { 
            transform: scale(1.1);
            background: var(--primary);
            color: white;
        }

        /* Game Layout */
        #game-container { 
            position: relative; 
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
        }
        
        .falling-heart { 
            position: absolute; 
            font-size: 35px; 
            cursor: pointer; 
            user-select: none;
            transition: transform 0.1s;
            z-index: 10;
        }
        
        .falling-heart:active {
            transform: scale(1.5);
        }

        /* Score Board */
        #score-board {
            position: absolute; 
            top: 20px; 
            left: 50%; 
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 100;
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: bold;
            text-align: center;
            min-width: 200px;
        }
        
        #score {
            font-size: 2rem;
            color: #ff3366;
        }

        #timer{
            font-size: 1rem;
            position: absolute; 
            top: 20px; 
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 10px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 50;
            color: var(--primary);
            font-weight: bold;
            text-align: center;
            min-width: 100px;
        }

        /* Valentine Modal */
        
        #valentine-modal::before {
            content: '';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 25px;
            white-space: nowrap;
        }
        #valentine-modal::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 25px;
            white-space: nowrap;
        }
        
        #valentine-modal .corner-tl {
            position: absolute;
            top: -25px;
            left: -25px;
            font-size: 25px;
            transform: rotate(-45deg);
        }
        
        #valentine-modal .corner-tr {
            position: absolute;
            top: -25px;
            right: -25px;
            font-size: 25px;
            transform: rotate(45deg);
        }
        
        #valentine-modal .corner-bl {
            position: absolute;
            bottom: -25px;
            left: -25px;
            font-size: 25px;
            transform: rotate(45deg);
        }
        
        #valentine-modal .corner-br {
            position: absolute;
            bottom: -25px;
            right: -25px;
            font-size: 25px;
            transform: rotate(-45deg);
        }
        
        #valentine-modal {
            display: none; 
            position: fixed; 
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            background: white; 
            padding: 40px; 
            border-radius: 20px;
            z-index: 1100; 
            width: 80%; 
            max-width: 500px;
            
            /*Rose Border*/
            border: 10px solid transparent;           
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: modalAppear 0.5s ease-in-out;
        }
        
        @keyframes modalAppear {
            from { opacity: 0; transform: translate(-50%, -40%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        
        #valentine-modal h1 {
            font-family: 'Arial';
            color: var(--primary);
            font-size: 2.5rem;
            margin: 0 0 30px 0;
        }
        
        .btn-container { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin-top: 20px;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        #yes-btn { 
            background: var(--primary); 
            color: white;
            box-shadow: 0 4px 15px rgba(255, 77, 109, 0.4);
        }
        
        #yes-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 77, 109, 0.6);
        }
        
        #no-btn { 
            background: #f0f0f0; 
            color: #666;
            position: relative;
            transition: all 0.2s ease;
        }
        
        #no-btn:hover {
            background: #e0e0e0;
        }

        /* Game Over Screen */
        #game-over-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        #game-over-screen h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #ff4d6d;
        }
        
        #game-over-screen button {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: #ff4d6d;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #game-over-screen button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 77, 109, 0.4);
        }

        /* Celebration styles */
        .celebration {
            font-family: 'Arial';
            color: var(--primary);
            font-size: 3rem;
            text-align: center;
            padding: 20px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }
            
            .game-title {
                font-size: 2rem !important;
            }
            
            #start-screen {
                padding: 20px;
            }
            
            .start-btn {
                padding: 15px 30px !important;
                font-size: 1.1rem !important;
            }
            
            #score-board {
                position: fixed;
                top: 10px;
                right: 10px;
                font-size: 1rem;
                background: rgba(255, 255, 255, 0.9);
                padding: 8px 15px;
                border-radius: 25px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                z-index: 50;
            }
            
            #timer {
                font-size: 0.9rem;
                top: 60px;
                right: 10px;
                padding: 8px 15px;
                min-width: 80px;
                position:fixed; 
            }
            
            #valentine-modal {
                width: 85% !important;
                padding: 25px 15px !important;
                margin: 15px;
            }
            
            #valentine-modal h1 {
                font-size: 1.8rem !important;
                text-align: center;
                margin-bottom: 20px;
            }
            
            .btn-container {
                flex-direction: row;
                gap: 15px;
            }
            
            button {
                padding: 15px 25px;
                font-size: 1.1rem;
                min-width: 200px;
            }
            
            #yes-btn, #no-btn {
                width: 20%;
            }
            
            .celebration {
                font-size: 2rem !important;
                padding: 15px;
            }
            
            .celebration span {
                font-size: 1.2rem !important;
            }
            
            #game-over-screen h1 {
                font-size: 1.5rem !important;
                
            }
            
            #game-over-screen button {
                padding: 12px 30px;
                font-size: 1.1rem;
            }
            
            .falling-heart {
                font-size: 2rem !important;
            }
        }
        
        @media (max-width: 480px) {
            .game-title {
                font-size: 1.5rem !important;
            }
            
            #valentine-modal h1 {
                font-size: 1.5rem !important;
            }
            
            .celebration {
                font-size: 1.5rem !important;
            }
            
            button {
                font-size: 1rem;
                min-width: 180px;
            }
        }
    </style>
</head>
<body>

    <!-- Audio Elements -->
    <!-- Using Web Audio API instead of external files -->

    <!-- Start Screen -->
    <div id="start-screen">
        <h1 class="game-title">Catch My Heart</h1>
        <button class="start-btn" onclick="startGame()">Start Game</button>
    </div>

    <!-- Game Elements -->
    <div id="score-board">
        HEARTS: <span id="score">0</span> / 10
    </div>
    <div id="timer">15s</div>

    <div id="game-container"></div>

    <!-- Game Over Screen -->
    <div id="game-over-screen">
        <h1>Game Over! My heart is still locked!</h1>
        <button onclick="resetGame()">Try Again</button>
    </div>

    <!-- Valentine Modal -->
    <div id="valentine-modal">
        <h1>Will you be my Valentine?</h1>
        <div class="btn-container">
            <button id="yes-btn" onclick="celebrate()">YES!</button>
            <button id="no-btn" onmouseover="moveNoButton()">No</button>
        </div>
    </div>

    <script>
        // Game variables
        let score = 0;
        let gameActive = false;
        let heartInterval;
        let gameTimer;
        let timeLeft = 10; // 10 seconds timer
        let timerStarted = false; // Track if timer has started
        const container = document.getElementById('game-container');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const modal = document.getElementById('valentine-modal');
        const gameOverScreen = document.getElementById('game-over-screen');
        const noBtn = document.getElementById('no-btn');
        const startScreen = document.getElementById('start-screen');
        
        // Web Audio API setup for click sounds
        let audioContext = null;
        
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Play click sound function using Web Audio API
        function playClickSound() {
            initAudio();
            
            // Create a simple, sharp click sound
            const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.01, audioContext.sampleRate);
            const noiseSource = audioContext.createBufferSource();
            const gainNode = audioContext.createGain();
            
            // Generate white noise for the click
            const output = noiseBuffer.getChannelData(0);
            for (let i = 0; i < noiseBuffer.length; i++) {
                output[i] = (Math.random() * 2 - 1) * 0.2; // Lower amplitude for softer click
            }
            
            noiseSource.buffer = noiseBuffer;
            
            // Connect nodes
            noiseSource.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Very sharp attack and immediate decay
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.005);
            
            // Start and stop quickly
            noiseSource.start(audioContext.currentTime);
            noiseSource.stop(audioContext.currentTime + 0.01);
        }
        
        // Play heart catch sound function
        function playHeartSound() {
            initAudio();
            
            // Create a pleasant ding/pop sound for catching hearts
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Configure the heart sound - a pleasant chime
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
            
            // Smooth attack and decay for a pleasant sound
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }
        
        // Add click sound to all buttons
        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', playClickSound);
            });
        });
        
        // Start the game
        function startGame() {
            startScreen.style.transform = 'translateY(-100%)';
            gameActive = true;
            score = 0;
            timeLeft = 10;
            timerStarted = false; // Reset timer started flag
            scoreDisplay.textContent = '0';
            timerDisplay.textContent = '10s'; // Show initial time
            container.innerHTML = '';
            gameOverScreen.style.display = 'none';
            
            // Start creating hearts
            if (heartInterval) clearInterval(heartInterval);
            if (gameTimer) clearInterval(gameTimer);
            
            heartInterval = setInterval(createHeart, 800);
            // Don't start timer yet - wait for first heart click
        }

        // Update game timer
        function updateTimer() {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            if (timeLeft <= 0) {
                gameOver();
            }
        }

        // Game over function
        function gameOver() {
            gameActive = false;
            clearInterval(heartInterval);
            clearInterval(gameTimer);
            gameOverScreen.style.display = 'flex';
        }

        // Reset game function
        function resetGame() {
            gameOverScreen.style.display = 'none';
            startGame();
        }

        // Create a falling heart
        function createHeart() {
            if (!gameActive) return;
            
            const heart = document.createElement('div');
            heart.innerHTML = '❤️';
            heart.className = 'falling-heart';
            
            // Random position at the top
            const startPos = Math.random() * (window.innerWidth - 40) +'px';
            heart.style.left = startPos;
            heart.style.top = '-50px';
            
            // Random animation duration
            let duration = Math.random() * 4000 + 4000;
            let animation = heart.animate([
                { transform: 'translateY(0vh)' },
                { transform: `translateY(${window.innerHeight + 50}px)` }
            ], { duration: duration, easing: 'linear' });
            
            // Add click/touch event
            const catchHeart = () => {
                if (!gameActive) return;
                
                // Play heart catch sound
                playHeartSound();
                
                // Start timer on first heart click
                if (!timerStarted) {
                    timerStarted = true;
                    gameTimer = setInterval(updateTimer, 1000);
                }
                
                // Update score
                score++;
                scoreDisplay.textContent = score;
                
                // Add pop effect
                heart.style.transform = 'scale(1.5)';
                setTimeout(() => heart.remove(), 100);
                
                // Check win condition
                if (score >= 10) {
                    winGame();
                }
            };
            
            heart.addEventListener('mousedown', catchHeart);
            heart.addEventListener('touchstart', catchHeart, { passive: true });
            
            container.appendChild(heart);
            
            // Remove heart when animation completes
            animation.onfinish = () => {
                if (heart.parentNode) {
                    heart.remove();
                }
            };
        }
        
        // Win the game
        function winGame() {
            gameActive = false;
            clearInterval(heartInterval);
            clearInterval(gameTimer);
            modal.style.display = 'block';
        }
        
        // Move the No button away when hovered
        function moveNoButton() {
            const containerRect = document.body.getBoundingClientRect();
            const buttonRect = noBtn.getBoundingClientRect();
            
            // Calculate new position ensuring it stays within viewport
            const maxX = containerRect.width - buttonRect.width - 20;
            const maxY = containerRect.height - buttonRect.height - 20;
            
            let newX = Math.random() * maxX;
            let newY = Math.random() * maxY;
            
            // Ensure the button doesn't go off-screen
            newX = Math.max(20, Math.min(newX, maxX));
            newY = Math.max(20, Math.min(newY, maxY));
            
            // Apply new position with smooth transition
            noBtn.style.position = 'fixed';
            noBtn.style.left = newX + 'px';
            noBtn.style.top = newY + 'px';
        }
        
        // Celebration when user clicks YES
        function celebrate() {
            // Update modal content
            modal.innerHTML = `
                <div class="celebration">
                    I Knew You'd Say Yes! <br>
                    ❤️ <br>
                    <span style="font-size: 1.5rem;">See you on the 14th!</span>
                </div>
            `;
            
            // Launch confetti
            confetti({
                particleCount: 200,
                spread: 90,
                origin: { y: 0.6 },
                colors: ['#ff4d6d', '#ff758f', '#ffb3c1', '#ffffff'],
                scalar: 1.2
            });
            
            // Keep the party going!
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    angle: 60,
                    spread: 70,
                    origin: { x: 0, y: 0.7 },
                    colors: ['#ff4d6d', '#ffb3c1', '#ffffff']
                });
                
                confetti({
                    particleCount: 100,
                    angle: 120,
                    spread: 70,
                    origin: { x: 1, y: 0.7 },
                    colors: ['#ff4d6d', '#ffb3c1', '#ffffff']
                });
            }, 300);
        }
        
        // Make the No button move on touch for mobile
        noBtn.addEventListener('touchstart', (e) => {
            moveNoButton();
        }, { passive: true });
    </script>
</body>
</html>